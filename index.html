<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>todo</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css">
</head>
<style>

*{
    box-sizing: border-box;
}
body{
    background:#21243d;
    color:#88e1f2;
    display:flex;
    flex-direction: column;
    justify-content: space-evenly;
    height:100vh;
    width:100vw;
    margin:0 auto;

}

ol{
    height:50vh;
    overflow: auto;
    width:80%
}

#wrapper{
    display:flex;
    justify-content: center;
    align-items: center;
    overflow: auto;
}

#result{
   
    height:30vw;
    width:30vw;
    border:solid 1px white;
    overflow:auto;
}

#db{
    display:flex;
    flex-direction: column;
    margin:0 auto;
    border:solid 1px white;
    font-size: 1.6rem;
}

li{
    cursor:pointer;
    margin:2%;
}

input {
    text-align: center;
    background:black;
    color:white;
}
h1{
    text-align: center;
    display:flex;
    width:50vw;
    justify-content: space-evenly;
}

</style>
<body>
    <h1>
        <i class="fas fa-list-ul"></i>
        <span>Todo</span>
        <span>(<span id="length"></span>)</span>
    </h1>
    <ol id="db"></ol>
    <div id="wrapper">
        <form id="new">
            <div>
                <input autocomplete="off" id="enter" placeholder="new"/>
            </div>
        </form>
        <button id="eraseAll">Erase all</button>
        
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        let form = document.getElementById("new")
        form.onsubmit = send
        let eraseAll = document.getElementById('eraseAll')
        eraseAll.onclick = eraseall

        function eraseall(){
            if (confirm('erase all?')) socket.emit('erase all')
        }

        function send(e){
            e.preventDefault()            
            socket.emit("new", enter.value)
            enter.value = ""
        }

        function erase(e){
            if (confirm("Erase " + e.target.innerHTML + " ? ")) socket.emit("erase", e.target.innerHTML)
        }

        function transform(data){
            console.log(data)
            let num = document.getElementById("length")
            num.innerHTML = data.length
            db.innerHTML = ""
            for (let i = 0 ; i < data.length ; i ++){
                let newDiv = document.createElement('li')
                newDiv.addEventListener('click', erase)
                newDiv.innerHTML = data[i]
                db.append(newDiv)
            }
        }

        socket.on('db', data => transform(data.todo))

    </script>
</body>
</html>